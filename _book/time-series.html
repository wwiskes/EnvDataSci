<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8 Time Series | Introduction to Environmental Data Science</title>
  <meta name="description" content="Background, concepts and exercises for using R for environmental data science. The focus is on applying the R language and various libraries for data abstraction, transformation, data analysis, spatial data/mapping, statistical modeling, and time series, applied to environmental research." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="8 Time Series | Introduction to Environmental Data Science" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Background, concepts and exercises for using R for environmental data science. The focus is on applying the R language and various libraries for data abstraction, transformation, data analysis, spatial data/mapping, statistical modeling, and time series, applied to environmental research." />
  <meta name="github-repo" content="iGISc/EnvDataSci" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8 Time Series | Introduction to Environmental Data Science" />
  
  <meta name="twitter:description" content="Background, concepts and exercises for using R for environmental data science. The focus is on applying the R language and various libraries for data abstraction, transformation, data analysis, spatial data/mapping, statistical modeling, and time series, applied to environmental research." />
  

<meta name="author" content="Jerry Davis" />


<meta name="date" content="2021-04-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="statistics-and-modeling.html"/>
<link rel="next" href="communication.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.3/leaflet-providers-plugin.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Environmental Data Science</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#tools-for-environmental-data-science"><i class="fa fa-check"></i><b>1.1</b> Tools for Environmental Data Science</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#big-data-data-mining-and-exploratory-data-analysis"><i class="fa fa-check"></i><b>1.2</b> Big Data, Data Mining, and Exploratory Data Analysis</a><ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#exploratory-data-analysis"><i class="fa fa-check"></i><b>1.2.1</b> Exploratory Data Analysis</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#software-and-data-well-need"><i class="fa fa-check"></i><b>1.3</b> Software and data we’ll need</a><ul>
<li class="chapter" data-level="1.3.1" data-path="index.html"><a href="index.html#data"><i class="fa fa-check"></i><b>1.3.1</b> Data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-r.html"><a href="introduction-to-r.html"><i class="fa fa-check"></i><b>2</b> Introduction to R</a><ul>
<li class="chapter" data-level="2.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#variables"><i class="fa fa-check"></i><b>2.1</b> Variables</a></li>
<li class="chapter" data-level="2.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#functions"><i class="fa fa-check"></i><b>2.2</b> Functions</a></li>
<li class="chapter" data-level="2.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#expressions-and-statements"><i class="fa fa-check"></i><b>2.3</b> Expressions and Statements</a></li>
<li class="chapter" data-level="2.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#data-types"><i class="fa fa-check"></i><b>2.4</b> Data Types</a><ul>
<li class="chapter" data-level="2.4.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#integers"><i class="fa fa-check"></i><b>2.4.1</b> Integers</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#rectangular-data"><i class="fa fa-check"></i><b>2.5</b> Rectangular data</a></li>
<li class="chapter" data-level="2.6" data-path="introduction-to-r.html"><a href="introduction-to-r.html#data-structures-in-r"><i class="fa fa-check"></i><b>2.6</b> Data Structures in R</a><ul>
<li class="chapter" data-level="2.6.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#vectors"><i class="fa fa-check"></i><b>2.6.1</b> Vectors</a></li>
<li class="chapter" data-level="2.6.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#lists"><i class="fa fa-check"></i><b>2.6.2</b> Lists</a></li>
<li class="chapter" data-level="2.6.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#matrices"><i class="fa fa-check"></i><b>2.6.3</b> Matrices</a></li>
<li class="chapter" data-level="2.6.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#data-frames"><i class="fa fa-check"></i><b>2.6.4</b> Data frames</a></li>
<li class="chapter" data-level="2.6.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#factors"><i class="fa fa-check"></i><b>2.6.5</b> Factors</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="introduction-to-r.html"><a href="introduction-to-r.html#programming-scripts-in-rstudio"><i class="fa fa-check"></i><b>2.7</b> Programming scripts in RStudio</a><ul>
<li class="chapter" data-level="2.7.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#subsetting-with-logic"><i class="fa fa-check"></i><b>2.7.1</b> Subsetting with logic</a></li>
<li class="chapter" data-level="2.7.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#apply-functions"><i class="fa fa-check"></i><b>2.7.2</b> Apply functions</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="introduction-to-r.html"><a href="introduction-to-r.html#exercises"><i class="fa fa-check"></i><b>2.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-abstraction.html"><a href="data-abstraction.html"><i class="fa fa-check"></i><b>3</b> Data Abstraction</a><ul>
<li class="chapter" data-level="3.1" data-path="data-abstraction.html"><a href="data-abstraction.html#background-exploratory-data-analysis"><i class="fa fa-check"></i><b>3.1</b> Background: Exploratory Data Analysis</a></li>
<li class="chapter" data-level="3.2" data-path="data-abstraction.html"><a href="data-abstraction.html#the-tidyverse-and-what-well-explore-in-this-chapter"><i class="fa fa-check"></i><b>3.2</b> The Tidyverse and what we’ll explore in this chapter</a></li>
<li class="chapter" data-level="3.3" data-path="data-abstraction.html"><a href="data-abstraction.html#tibbles"><i class="fa fa-check"></i><b>3.3</b> Tibbles</a><ul>
<li class="chapter" data-level="3.3.1" data-path="data-abstraction.html"><a href="data-abstraction.html#read_csv-vs.-read.csv"><i class="fa fa-check"></i><b>3.3.1</b> <code>read_csv</code> vs. <code>read.csv</code></a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="data-abstraction.html"><a href="data-abstraction.html#statistical-summary-of-variables"><i class="fa fa-check"></i><b>3.4</b> Statistical summary of variables</a></li>
<li class="chapter" data-level="3.5" data-path="data-abstraction.html"><a href="data-abstraction.html#visualizing-data-with-a-tukey-box-plot"><i class="fa fa-check"></i><b>3.5</b> Visualizing data with a Tukey box plot</a></li>
<li class="chapter" data-level="3.6" data-path="data-abstraction.html"><a href="data-abstraction.html#database-operations-with-dplyr"><i class="fa fa-check"></i><b>3.6</b> Database operations with <code>dplyr</code></a><ul>
<li class="chapter" data-level="3.6.1" data-path="data-abstraction.html"><a href="data-abstraction.html#select-mutate-and-the-pipe"><i class="fa fa-check"></i><b>3.6.1</b> Select, mutate, and the pipe</a></li>
<li class="chapter" data-level="3.6.2" data-path="data-abstraction.html"><a href="data-abstraction.html#filter"><i class="fa fa-check"></i><b>3.6.2</b> filter</a></li>
<li class="chapter" data-level="3.6.3" data-path="data-abstraction.html"><a href="data-abstraction.html#writing-a-data-frame-to-a-csv"><i class="fa fa-check"></i><b>3.6.3</b> Writing a data frame to a csv</a></li>
<li class="chapter" data-level="3.6.4" data-path="data-abstraction.html"><a href="data-abstraction.html#summarize-by-group"><i class="fa fa-check"></i><b>3.6.4</b> Summarize by group</a></li>
<li class="chapter" data-level="3.6.5" data-path="data-abstraction.html"><a href="data-abstraction.html#count"><i class="fa fa-check"></i><b>3.6.5</b> Count</a></li>
<li class="chapter" data-level="3.6.6" data-path="data-abstraction.html"><a href="data-abstraction.html#sorting-after-summarizing"><i class="fa fa-check"></i><b>3.6.6</b> Sorting after summarizing</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="data-abstraction.html"><a href="data-abstraction.html#the-dot-operator"><i class="fa fa-check"></i><b>3.7</b> The dot operator</a></li>
<li class="chapter" data-level="3.8" data-path="data-abstraction.html"><a href="data-abstraction.html#exercises-1"><i class="fa fa-check"></i><b>3.8</b> Exercises</a></li>
<li class="chapter" data-level="3.9" data-path="data-abstraction.html"><a href="data-abstraction.html#string-abstraction"><i class="fa fa-check"></i><b>3.9</b> String Abstraction</a><ul>
<li class="chapter" data-level="3.9.1" data-path="data-abstraction.html"><a href="data-abstraction.html#detecting-matches"><i class="fa fa-check"></i><b>3.9.1</b> Detecting matches</a></li>
<li class="chapter" data-level="3.9.2" data-path="data-abstraction.html"><a href="data-abstraction.html#subsetting-strings"><i class="fa fa-check"></i><b>3.9.2</b> Subsetting Strings</a></li>
<li class="chapter" data-level="3.9.3" data-path="data-abstraction.html"><a href="data-abstraction.html#string-length"><i class="fa fa-check"></i><b>3.9.3</b> String Length</a></li>
<li class="chapter" data-level="3.9.4" data-path="data-abstraction.html"><a href="data-abstraction.html#replacing-substrings-with-other-text-mutating-strings"><i class="fa fa-check"></i><b>3.9.4</b> Replacing substrings with other text (“mutating” strings)</a></li>
<li class="chapter" data-level="3.9.5" data-path="data-abstraction.html"><a href="data-abstraction.html#concatenating-and-splitting"><i class="fa fa-check"></i><b>3.9.5</b> Concatenating and splitting</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="data-abstraction.html"><a href="data-abstraction.html#dates-and-times-with-lubridate"><i class="fa fa-check"></i><b>3.10</b> Dates and times with <code>lubridate</code></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="visualization.html"><a href="visualization.html"><i class="fa fa-check"></i><b>4</b> Visualization</a><ul>
<li class="chapter" data-level="4.1" data-path="visualization.html"><a href="visualization.html#ggplot2"><i class="fa fa-check"></i><b>4.1</b> ggplot2</a></li>
<li class="chapter" data-level="4.2" data-path="visualization.html"><a href="visualization.html#plotting-one-variable"><i class="fa fa-check"></i><b>4.2</b> Plotting one variable</a><ul>
<li class="chapter" data-level="4.2.1" data-path="visualization.html"><a href="visualization.html#histogram"><i class="fa fa-check"></i><b>4.2.1</b> Histogram</a></li>
<li class="chapter" data-level="4.2.2" data-path="visualization.html"><a href="visualization.html#density-plot"><i class="fa fa-check"></i><b>4.2.2</b> Density Plot</a></li>
<li class="chapter" data-level="4.2.3" data-path="visualization.html"><a href="visualization.html#boxplot"><i class="fa fa-check"></i><b>4.2.3</b> boxplot</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="visualization.html"><a href="visualization.html#plotting-two-variables"><i class="fa fa-check"></i><b>4.3</b> Plotting two variables</a><ul>
<li class="chapter" data-level="4.3.1" data-path="visualization.html"><a href="visualization.html#two-continuous-variables"><i class="fa fa-check"></i><b>4.3.1</b> Two continuous variables</a></li>
<li class="chapter" data-level="4.3.2" data-path="visualization.html"><a href="visualization.html#two-variables-one-discrete"><i class="fa fa-check"></i><b>4.3.2</b> Two variables, one discrete</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="visualization.html"><a href="visualization.html#color-systems"><i class="fa fa-check"></i><b>4.4</b> Color systems</a><ul>
<li class="chapter" data-level="4.4.1" data-path="visualization.html"><a href="visualization.html#color-from-variable-in-aesthetics"><i class="fa fa-check"></i><b>4.4.1</b> Color from variable, in aesthetics</a></li>
<li class="chapter" data-level="4.4.2" data-path="visualization.html"><a href="visualization.html#trend-line"><i class="fa fa-check"></i><b>4.4.2</b> Trend line</a></li>
<li class="chapter" data-level="4.4.3" data-path="visualization.html"><a href="visualization.html#general-symbology"><i class="fa fa-check"></i><b>4.4.3</b> General symbology</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="visualization.html"><a href="visualization.html#titles-and-subtitles"><i class="fa fa-check"></i><b>4.5</b> Titles and subtitles</a></li>
<li class="chapter" data-level="4.6" data-path="visualization.html"><a href="visualization.html#pairs-plot"><i class="fa fa-check"></i><b>4.6</b> Pairs Plot</a></li>
<li class="chapter" data-level="4.7" data-path="visualization.html"><a href="visualization.html#exercises-2"><i class="fa fa-check"></i><b>4.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-transformation.html"><a href="data-transformation.html"><i class="fa fa-check"></i><b>5</b> Data Transformation</a><ul>
<li class="chapter" data-level="5.1" data-path="data-transformation.html"><a href="data-transformation.html#data-joins"><i class="fa fa-check"></i><b>5.1</b> Data joins</a></li>
<li class="chapter" data-level="5.2" data-path="data-transformation.html"><a href="data-transformation.html#set-operations"><i class="fa fa-check"></i><b>5.2</b> Set Operations</a></li>
<li class="chapter" data-level="5.3" data-path="data-transformation.html"><a href="data-transformation.html#binding-rows-and-columns"><i class="fa fa-check"></i><b>5.3</b> Binding Rows and Columns</a></li>
<li class="chapter" data-level="5.4" data-path="data-transformation.html"><a href="data-transformation.html#pivotting-data-frames"><i class="fa fa-check"></i><b>5.4</b> Pivotting data frames</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="spatial-data-and-maps.html"><a href="spatial-data-and-maps.html"><i class="fa fa-check"></i><b>6</b> Spatial Data and Maps</a><ul>
<li class="chapter" data-level="6.1" data-path="spatial-data-and-maps.html"><a href="spatial-data-and-maps.html#spatial-data"><i class="fa fa-check"></i><b>6.1</b> Spatial Data</a><ul>
<li class="chapter" data-level="6.1.1" data-path="spatial-data-and-maps.html"><a href="spatial-data-and-maps.html#examples-of-simple-geometry-building-in-sf"><i class="fa fa-check"></i><b>6.1.1</b> Examples of simple geometry building in sf</a></li>
<li class="chapter" data-level="6.1.2" data-path="spatial-data-and-maps.html"><a href="spatial-data-and-maps.html#building-a-mappable-sfc-from-scratch"><i class="fa fa-check"></i><b>6.1.2</b> Building a mappable sfc from scratch</a></li>
<li class="chapter" data-level="6.1.3" data-path="spatial-data-and-maps.html"><a href="spatial-data-and-maps.html#creating-features-from-shapefiles-or-tables"><i class="fa fa-check"></i><b>6.1.3</b> Creating features from shapefiles or tables</a></li>
<li class="chapter" data-level="6.1.4" data-path="spatial-data-and-maps.html"><a href="spatial-data-and-maps.html#coordinate-referencing-system"><i class="fa fa-check"></i><b>6.1.4</b> Coordinate Referencing System</a></li>
<li class="chapter" data-level="6.1.5" data-path="spatial-data-and-maps.html"><a href="spatial-data-and-maps.html#spatial-join-st_join"><i class="fa fa-check"></i><b>6.1.5</b> Spatial join <code>st_join</code></a></li>
<li class="chapter" data-level="6.1.6" data-path="spatial-data-and-maps.html"><a href="spatial-data-and-maps.html#plotting-maps-in-the-base-plot-system"><i class="fa fa-check"></i><b>6.1.6</b> Plotting maps in the base plot system</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="spatial-data-and-maps.html"><a href="spatial-data-and-maps.html#raster-gis-in-r"><i class="fa fa-check"></i><b>6.2</b> Raster GIS in R</a><ul>
<li class="chapter" data-level="6.2.1" data-path="spatial-data-and-maps.html"><a href="spatial-data-and-maps.html#raster-from-scratch"><i class="fa fa-check"></i><b>6.2.1</b> Raster from scratch</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="spatial-data-and-maps.html"><a href="spatial-data-and-maps.html#ggplot2-for-maps"><i class="fa fa-check"></i><b>6.3</b> ggplot2 for maps</a><ul>
<li class="chapter" data-level="6.3.1" data-path="spatial-data-and-maps.html"><a href="spatial-data-and-maps.html#rasters-in-ggplot2"><i class="fa fa-check"></i><b>6.3.1</b> Rasters in ggplot2</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="spatial-data-and-maps.html"><a href="spatial-data-and-maps.html#tmap"><i class="fa fa-check"></i><b>6.4</b> tmap</a></li>
<li class="chapter" data-level="6.5" data-path="spatial-data-and-maps.html"><a href="spatial-data-and-maps.html#interactive-maps"><i class="fa fa-check"></i><b>6.5</b> Interactive Maps</a></li>
<li class="chapter" data-level="6.6" data-path="spatial-data-and-maps.html"><a href="spatial-data-and-maps.html#exercises-3"><i class="fa fa-check"></i><b>6.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="statistics-and-modeling.html"><a href="statistics-and-modeling.html"><i class="fa fa-check"></i><b>7</b> Statistics and Modeling</a><ul>
<li class="chapter" data-level="7.1" data-path="statistics-and-modeling.html"><a href="statistics-and-modeling.html#goals-of-statistical-analysis"><i class="fa fa-check"></i><b>7.1</b> Goals of statistical analysis</a></li>
<li class="chapter" data-level="7.2" data-path="statistics-and-modeling.html"><a href="statistics-and-modeling.html#summary-statistics"><i class="fa fa-check"></i><b>7.2</b> Summary Statistics</a><ul>
<li class="chapter" data-level="7.2.1" data-path="statistics-and-modeling.html"><a href="statistics-and-modeling.html#summarize-by-group-stratifying-a-summary"><i class="fa fa-check"></i><b>7.2.1</b> Summarize by group: <em>stratifying a summary</em></a></li>
<li class="chapter" data-level="7.2.2" data-path="statistics-and-modeling.html"><a href="statistics-and-modeling.html#boxplot-for-visualizing-distributions-by-group"><i class="fa fa-check"></i><b>7.2.2</b> Boxplot for visualizing distributions by group</a></li>
<li class="chapter" data-level="7.2.3" data-path="statistics-and-modeling.html"><a href="statistics-and-modeling.html#generating-pseudorandom-numbers"><i class="fa fa-check"></i><b>7.2.3</b> Generating pseudorandom numbers</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="statistics-and-modeling.html"><a href="statistics-and-modeling.html#statistical-tests"><i class="fa fa-check"></i><b>7.3</b> Statistical tests</a><ul>
<li class="chapter" data-level="7.3.1" data-path="statistics-and-modeling.html"><a href="statistics-and-modeling.html#comparing-samples-and-groupings"><i class="fa fa-check"></i><b>7.3.1</b> Comparing samples and groupings</a></li>
<li class="chapter" data-level="7.3.2" data-path="statistics-and-modeling.html"><a href="statistics-and-modeling.html#correlation"><i class="fa fa-check"></i><b>7.3.2</b> Correlation</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="statistics-and-modeling.html"><a href="statistics-and-modeling.html#modeling-in-r"><i class="fa fa-check"></i><b>7.4</b> Modeling in R</a><ul>
<li class="chapter" data-level="7.4.1" data-path="statistics-and-modeling.html"><a href="statistics-and-modeling.html#analysis-of-covariance"><i class="fa fa-check"></i><b>7.4.1</b> Analysis of Covariance</a></li>
<li class="chapter" data-level="7.4.2" data-path="statistics-and-modeling.html"><a href="statistics-and-modeling.html#generalized-linear-model-glm"><i class="fa fa-check"></i><b>7.4.2</b> Generalized Linear Model (GLM)</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="statistics-and-modeling.html"><a href="statistics-and-modeling.html#spatial-statistical-analysis"><i class="fa fa-check"></i><b>7.5</b> Spatial Statistical Analysis</a><ul>
<li class="chapter" data-level="7.5.1" data-path="statistics-and-modeling.html"><a href="statistics-and-modeling.html#spatial-autocorrelation"><i class="fa fa-check"></i><b>7.5.1</b> Spatial Autocorrelation</a></li>
<li class="chapter" data-level="7.5.2" data-path="statistics-and-modeling.html"><a href="statistics-and-modeling.html#mapping-residuals"><i class="fa fa-check"></i><b>7.5.2</b> Mapping Residuals</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="time-series.html"><a href="time-series.html"><i class="fa fa-check"></i><b>8</b> Time Series</a><ul>
<li class="chapter" data-level="8.1" data-path="time-series.html"><a href="time-series.html#creation-of-time-series-ts-data"><i class="fa fa-check"></i><b>8.1</b> Creation of time series (ts) data</a><ul>
<li class="chapter" data-level="8.1.1" data-path="time-series.html"><a href="time-series.html#frequency-setting"><i class="fa fa-check"></i><b>8.1.1</b> frequency setting</a></li>
<li class="chapter" data-level="8.1.2" data-path="time-series.html"><a href="time-series.html#data-logger-data-from-marble-mountains-resurgence"><i class="fa fa-check"></i><b>8.1.2</b> Data logger data from Marble Mountains resurgence</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="time-series.html"><a href="time-series.html#data-smoothing-methods"><i class="fa fa-check"></i><b>8.2</b> Data smoothing methods</a><ul>
<li class="chapter" data-level="8.2.1" data-path="time-series.html"><a href="time-series.html#moving-average-ma"><i class="fa fa-check"></i><b>8.2.1</b> moving average (ma)</a></li>
<li class="chapter" data-level="8.2.2" data-path="time-series.html"><a href="time-series.html#loess-local-regression-smoothing"><i class="fa fa-check"></i><b>8.2.2</b> loess (local regression) smoothing</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="time-series.html"><a href="time-series.html#decomposing-time-series"><i class="fa fa-check"></i><b>8.3</b> Decomposing time series</a><ul>
<li class="chapter" data-level="8.3.1" data-path="time-series.html"><a href="time-series.html#lag-regression"><i class="fa fa-check"></i><b>8.3.1</b> lag regression</a></li>
<li class="chapter" data-level="8.3.2" data-path="time-series.html"><a href="time-series.html#ensemble-average"><i class="fa fa-check"></i><b>8.3.2</b> Ensemble Average</a></li>
<li class="chapter" data-level="8.3.3" data-path="time-series.html"><a href="time-series.html#julian-dates"><i class="fa fa-check"></i><b>8.3.3</b> Julian Dates</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="time-series.html"><a href="time-series.html#learning-more-about-time-series-in-r"><i class="fa fa-check"></i><b>8.4</b> Learning more about time series in R</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="communication.html"><a href="communication.html"><i class="fa fa-check"></i><b>9</b> Communication</a></li>
<li class="chapter" data-level="" data-path="appendix-building-a-data-package-for-github.html"><a href="appendix-building-a-data-package-for-github.html"><i class="fa fa-check"></i>Appendix: Building a Data Package for GitHub</a><ul>
<li><a href="appendix-building-a-data-package-for-github.html#rda-files"><code>rda</code> files</a><ul>
<li><a href="appendix-building-a-data-package-for-github.html#usethisuse_data"><code>usethis::use_data()</code></a></li>
<li><a href="appendix-building-a-data-package-for-github.html#usethiscreate_package"><code>usethis::create_package()</code></a></li>
<li><a href="appendix-building-a-data-package-for-github.html#devtoolsdocument"><code>devtools::document()</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix-building-a-data-package-for-github.html"><a href="appendix-building-a-data-package-for-github.html#raw-data"><i class="fa fa-check"></i>Raw data</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to Environmental Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="time-series" class="section level1">
<h1><span class="header-section-number">8</span> Time Series</h1>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="time-series.html#cb449-1"></a><span class="kw">plot</span>(<span class="kw">stl</span>(co2, <span class="dt">s.window =</span> <span class="st">&quot;periodic&quot;</span>)) <span class="co"># co2 is already a time series</span></span></code></pre></div>
<p><img src="EnvDataSci_files/figure-html/unnamed-chunk-199-1.png" width="672" /></p>
<p>Time series data are widely used in the financial sector for obvious reasons, and
these methods can be very useful environmental data science especially in studies
such as looking at long-term climate change variables such as the Mauna Loa CO<sub>2</sub>
data above, or at the much finer temporal scale, environmental data from data loggers such as eddy covariance
flux towers.</p>
<p><img src="img/RCVfluxTower1.png">
<img src="img/LoneyGraph.png">
<img src="img/RCVfluxTower2.png"></p>
<div id="creation-of-time-series-ts-data" class="section level2">
<h2><span class="header-section-number">8.1</span> Creation of time series (ts) data</h2>
<p>A time series (ts) is created with the ts() function.</p>
<ul>
<li>the time unit can be anything – not actually saved with the ts</li>
<li>observations must be a regularly spaced series</li>
</ul>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="time-series.html#cb450-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb450-2"><a href="time-series.html#cb450-2"></a>SFhighF &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">58</span>,<span class="dv">61</span>,<span class="dv">62</span>,<span class="dv">63</span>,<span class="dv">64</span>,<span class="dv">67</span>,<span class="dv">67</span>,<span class="dv">68</span>,<span class="dv">71</span>,<span class="dv">70</span>,<span class="dv">64</span>,<span class="dv">58</span>)</span>
<span id="cb450-3"><a href="time-series.html#cb450-3"></a>SFlowF  &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">47</span>,<span class="dv">48</span>,<span class="dv">49</span>,<span class="dv">50</span>,<span class="dv">51</span>,<span class="dv">53</span>,<span class="dv">54</span>,<span class="dv">55</span>,<span class="dv">56</span>,<span class="dv">55</span>,<span class="dv">51</span>,<span class="dv">47</span>)</span>
<span id="cb450-4"><a href="time-series.html#cb450-4"></a>SFhighC &lt;-<span class="st"> </span>(SFhighF<span class="dv">-32</span>)<span class="op">*</span><span class="dv">5</span><span class="op">/</span><span class="dv">9</span></span>
<span id="cb450-5"><a href="time-series.html#cb450-5"></a>SFlowC  &lt;-<span class="st"> </span>(SFlowF<span class="dv">-32</span>)<span class="op">*</span><span class="dv">5</span><span class="op">/</span><span class="dv">9</span></span>
<span id="cb450-6"><a href="time-series.html#cb450-6"></a>SFtempC &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(<span class="dt">high=</span>SFhighC,<span class="dt">low=</span>SFlowC)</span>
<span id="cb450-7"><a href="time-series.html#cb450-7"></a><span class="kw">plot</span>(SFtempC);                  <span class="kw">plot</span>(<span class="kw">ts</span>(SFtempC))</span></code></pre></div>
<p><img src="EnvDataSci_files/figure-html/unnamed-chunk-200-1.png" width="672" /><img src="EnvDataSci_files/figure-html/unnamed-chunk-200-2.png" width="672" /></p>
<div id="frequency-setting" class="section level3">
<h3><span class="header-section-number">8.1.1</span> frequency setting</h3>
<p>Frequency setting is a key parameter for ts()</p>
<ul>
<li>sets how many observations per time unit</li>
<li>ts() mostly doesn’t seem to care what the time unit is, however some functions figure it out, at least for an annual time unit, e.g. that 1-12 means months when there’s a frequency of 12</li>
</ul>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="time-series.html#cb451-1"></a><span class="kw">plot</span>(<span class="kw">ts</span>(SFtempC, <span class="dt">frequency=</span><span class="dv">1</span>), <span class="dt">main=</span><span class="st">&quot;monthly time unit&quot;</span>)</span></code></pre></div>
<p><img src="EnvDataSci_files/figure-html/unnamed-chunk-201-1.png" width="672" /></p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="time-series.html#cb452-1"></a><span class="kw">plot</span>(<span class="kw">ts</span>(SFtempC, <span class="dt">frequency=</span><span class="dv">12</span>), <span class="dt">main=</span><span class="st">&quot;yearly time unit&quot;</span>)</span></code></pre></div>
<p><img src="EnvDataSci_files/figure-html/unnamed-chunk-201-2.png" width="672" /></p>
<p><strong>frequency &lt; 1</strong></p>
<p>If you have data of lower frequency than 1 per unit</p>
<ul>
<li>e.g. greenhouse gas data values every 20 years, starting in year 20, frequency 1/20 = 0.05</li>
</ul>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="time-series.html#cb453-1"></a><span class="kw">library</span>(dslabs)</span>
<span id="cb453-2"><a href="time-series.html#cb453-2"></a><span class="kw">data</span>(<span class="st">&quot;greenhouse_gases&quot;</span>)</span>
<span id="cb453-3"><a href="time-series.html#cb453-3"></a>GHGwide &lt;-<span class="st"> </span><span class="kw">pivot_wider</span>(greenhouse_gases, <span class="dt">names_from =</span> gas, </span>
<span id="cb453-4"><a href="time-series.html#cb453-4"></a>                       <span class="dt">values_from =</span> concentration)</span>
<span id="cb453-5"><a href="time-series.html#cb453-5"></a>GHG &lt;-<span class="st"> </span><span class="kw">ts</span>(GHGwide, <span class="dt">frequency=</span><span class="fl">0.05</span>, <span class="dt">start=</span><span class="dv">20</span>) </span>
<span id="cb453-6"><a href="time-series.html#cb453-6"></a><span class="kw">plot</span>(GHG)</span></code></pre></div>
<p><img src="EnvDataSci_files/figure-html/unnamed-chunk-202-1.png" width="672" /></p>
<p><strong>start and end parameters</strong></p>
<ul>
<li>the time of the first (start) and last (end) observations. Either a single number or a vector of two numbers (the second of which is an integer), which specify a natural time unit and a (1-based) number of samples into the time unit.</li>
<li>Example with year as the time unit and monthly data, starting July 2019 and ending June 2020:</li>
</ul>
<p><code>frequency=12, start=c(2019,7), end=c(2020,6)</code></p>
</div>
<div id="data-logger-data-from-marble-mountains-resurgence" class="section level3">
<h3><span class="header-section-number">8.1.2</span> Data logger data from Marble Mountains resurgence</h3>
<p>[<strong><code>Marbles</code></strong>]</p>
<p>For a study of chemical water quality and hydrology of a karst system in the Marble Mountains of California,
a spring <em>resurgence</em> was instrumented to measure water level, temperature, and specific conductance (a surrogate for total dissolved solids) over a 4-year period.</p>
<p><img src="img/resurgenceInstallation.png">
<img src="img/resurgenceProfile.png">
<img src="img/instrumentationPicture.png">
<img src="img/instrumentationLower.png">
<img src="img/instrumentationDiagram.png">
<img src="img/stillingWell.png"></p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="time-series.html#cb454-1"></a><span class="kw">library</span>(tidyverse); <span class="kw">library</span>(lubridate)</span>
<span id="cb454-2"><a href="time-series.html#cb454-2"></a>resurg &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>,<span class="st">&quot;resurgenceData.csv&quot;</span>,<span class="dt">package=</span><span class="st">&quot;iGIScData&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb454-3"><a href="time-series.html#cb454-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date_time =</span> <span class="kw">mdy_hms</span>(<span class="kw">paste</span>(date, time))) <span class="op">%&gt;%</span></span>
<span id="cb454-4"><a href="time-series.html#cb454-4"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(date_time, ATemp, BTemp, wlevelm, EC, InputV)</span>
<span id="cb454-5"><a href="time-series.html#cb454-5"></a>resurgTS &lt;-<span class="st"> </span><span class="kw">ts</span>(resurg, <span class="dt">frequency =</span> <span class="dv">12</span><span class="op">*</span><span class="dv">365</span>, <span class="dt">start =</span> <span class="kw">c</span>(<span class="dv">1994</span>, <span class="dv">266</span><span class="op">*</span><span class="dv">12</span><span class="op">+</span><span class="dv">7</span>))</span>
<span id="cb454-6"><a href="time-series.html#cb454-6"></a><span class="kw">plot</span>(resurgTS)</span></code></pre></div>
<p><img src="EnvDataSci_files/figure-html/unnamed-chunk-203-1.png" width="672" /></p>
</div>
</div>
<div id="data-smoothing-methods" class="section level2">
<h2><span class="header-section-number">8.2</span> Data smoothing methods</h2>
<div id="moving-average-ma" class="section level3">
<h3><span class="header-section-number">8.2.1</span> moving average (ma)</h3>
<ul>
<li>Simple generalization of sequential data</li>
<li>The order parameter is how many values are averaged in the moving window
<ul>
<li>should be an odd number</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb455-1"><a href="time-series.html#cb455-1"></a><span class="kw">library</span>(forecast)</span>
<span id="cb455-2"><a href="time-series.html#cb455-2"></a><span class="kw">ts</span>(SFtempC, <span class="dt">frequency=</span><span class="dv">12</span>)</span></code></pre></div>
<pre><code>##           high       low
## Jan 1 14.44444  8.333333
## Feb 1 16.11111  8.888889
## Mar 1 16.66667  9.444444
## Apr 1 17.22222 10.000000
## May 1 17.77778 10.555556
## Jun 1 19.44444 11.666667
## Jul 1 19.44444 12.222222
## Aug 1 20.00000 12.777778
## Sep 1 21.66667 13.333333
## Oct 1 21.11111 12.777778
## Nov 1 17.77778 10.555556
## Dec 1 14.44444  8.333333</code></pre>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="time-series.html#cb457-1"></a><span class="kw">ma</span>(<span class="kw">ts</span>(SFtempC,<span class="dt">frequency=</span><span class="dv">12</span>),<span class="dt">order=</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>##           [,1]      [,2]
## Jan 1       NA        NA
## Feb 1 15.74074  8.888889
## Mar 1 16.66667  9.444444
## Apr 1 17.22222 10.000000
## May 1 18.14815 10.740741
## Jun 1 18.88889 11.481481
## Jul 1 19.62963 12.222222
## Aug 1 20.37037 12.777778
## Sep 1 20.92593 12.962963
## Oct 1 20.18519 12.222222
## Nov 1 17.77778 10.555556
## Dec 1       NA        NA</code></pre>
<p><strong>moving average of CO2 data</strong></p>
<p>Difference shows time-local fluctuations, a component of the data</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="time-series.html#cb459-1"></a><span class="kw">library</span>(dslabs)</span>
<span id="cb459-2"><a href="time-series.html#cb459-2"></a><span class="kw">data</span>(<span class="st">&quot;greenhouse_gases&quot;</span>)</span>
<span id="cb459-3"><a href="time-series.html#cb459-3"></a>GHGwide &lt;-<span class="st"> </span><span class="kw">pivot_wider</span>(greenhouse_gases, </span>
<span id="cb459-4"><a href="time-series.html#cb459-4"></a>           <span class="dt">names_from =</span> gas, </span>
<span id="cb459-5"><a href="time-series.html#cb459-5"></a>           <span class="dt">values_from =</span> concentration)</span>
<span id="cb459-6"><a href="time-series.html#cb459-6"></a>CO2 &lt;-<span class="st"> </span><span class="kw">ts</span>(GHGwide<span class="op">$</span>CO2,</span>
<span id="cb459-7"><a href="time-series.html#cb459-7"></a>          <span class="dt">frequency =</span> <span class="fl">0.05</span>)</span>
<span id="cb459-8"><a href="time-series.html#cb459-8"></a><span class="kw">library</span>(forecast)</span>
<span id="cb459-9"><a href="time-series.html#cb459-9"></a>CO2ma &lt;-<span class="st"> </span><span class="kw">ma</span>(CO2, <span class="dt">order=</span><span class="dv">7</span>)</span>
<span id="cb459-10"><a href="time-series.html#cb459-10"></a><span class="kw">plot</span>(CO2)</span></code></pre></div>
<p><img src="EnvDataSci_files/figure-html/unnamed-chunk-205-1.png" width="672" /></p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="time-series.html#cb460-1"></a><span class="kw">plot</span>(CO2ma)</span></code></pre></div>
<p><img src="EnvDataSci_files/figure-html/unnamed-chunk-205-2.png" width="672" /></p>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="time-series.html#cb461-1"></a><span class="kw">plot</span>(CO2<span class="op">-</span>CO2ma)</span></code></pre></div>
<p><img src="EnvDataSci_files/figure-html/unnamed-chunk-205-3.png" width="672" /></p>
</div>
<div id="loess-local-regression-smoothing" class="section level3">
<h3><span class="header-section-number">8.2.2</span> loess (local regression) smoothing</h3>
<p>[place holder – need to work out]</p>
<p>From:</p>
<p><a href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess">https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/loess</a></p>
<p>Local Polynomial Regression Fitting</p>
<ul>
<li>Fit a polynomial surface determined by one or more numerical predictors, using local fitting.</li>
</ul>
<p>From:<br />
<a href="http://r-statistics.co/Loess-Regression-With-R.html">http://r-statistics.co/Loess-Regression-With-R.html</a></p>
<p>a non-parametric approach that fits regressions within local neighborhoods</p>
<ul>
<li>if X variables are bound within a range [?]</li>
</ul>
</div>
</div>
<div id="decomposing-time-series" class="section level2">
<h2><span class="header-section-number">8.3</span> Decomposing time series</h2>
<p>: separating a time series into its constituent components.</p>
<ul>
<li>original data</li>
<li>trend component, removes seasonal and remainder</li>
<li>if seasonal, also a seasonal component. Note that <strong>season</strong> relates to the time unit. If 1 year, “seasonality” refers to the
normal usage of seasons over a year. But if 1 day, seasons refers to different parts of a day, etc.</li>
<li>irregular “random” remainder (time-local variation)</li>
</ul>
<p>There are two common decomposition methods, the classic method <code>decompose</code> using moving averages, which we’ll look
at first, then the “loess” method used by <code>stl</code>.</p>
<p><strong>Mauna Loa CO<sub>2</sub> data with seasonality</strong></p>
<p>A good place to see the effect of seasonality is to look at the Mauna Loa CO<sub>2</sub> data, which shows regular annual cycles, yet with
a regularly increasing trend over the years. The decomposition shows the original observations, followed by a trend line that removes the seasonal and local (short-term) random irregularities, a detrended <em>seasonal</em> picture which removes that trend to just show the seasonal cycles, followed by the random irregularities. Note the vertical scale: the units are all the same – parts per million – so the actual amplitude of the seasonal cycle should be the same as the annual amplitude of the observations, it’s just scaled to the chart height, which tends to exaggerate the seasonal cycles and random irregularities.</p>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="time-series.html#cb462-1"></a><span class="kw">plot</span>(<span class="kw">decompose</span>(co2))</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-206"></span>
<img src="EnvDataSci_files/figure-html/unnamed-chunk-206-1.png" alt="Decomposition of Mauna Loa monthly co2 time series (in base) extending from 1959 to 1981" width="672" />
<p class="caption">
Figure 8.1: Decomposition of Mauna Loa monthly co2 time series (in base) extending from 1959 to 1981
</p>
</div>
<p><strong>Seasonal decomposition using loess</strong></p>
<p>The <code>stl</code> function stands for “Seasonal decomposition of Time series by Loess”.<br />
Loess is a smoothing algorithm, that wor. If s.window = “periodic” the mean is used for smoothing;
the seasonal values are removed and the remainder smoothed to find the trend.</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="time-series.html#cb463-1"></a><span class="kw">plot</span>(<span class="kw">stl</span>(co2, <span class="dt">s.window=</span><span class="st">&quot;periodic&quot;</span>))</span></code></pre></div>
<p><img src="EnvDataSci_files/figure-html/unnamed-chunk-207-1.png" width="672" /></p>
<p><strong>Marble Mountains karst resurgence study</strong></p>
<p>[<strong><code>Marbles</code></strong>]</p>
<p>In the Marble Mountains karst resurgence study, water level water level has an annual seasonality
that might be best understand by decomposition.</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="time-series.html#cb464-1"></a><span class="kw">library</span>(tidyverse); <span class="kw">library</span>(lubridate)</span>
<span id="cb464-2"><a href="time-series.html#cb464-2"></a>resurg &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>,<span class="st">&quot;resurgenceData.csv&quot;</span>,<span class="dt">package=</span><span class="st">&quot;iGIScData&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb464-3"><a href="time-series.html#cb464-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date_time =</span> <span class="kw">mdy_hms</span>(<span class="kw">paste</span>(date, time))) <span class="op">%&gt;%</span></span>
<span id="cb464-4"><a href="time-series.html#cb464-4"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(date_time, ATemp, BTemp, wlevelm, EC, InputV)</span>
<span id="cb464-5"><a href="time-series.html#cb464-5"></a>wlevelm &lt;-<span class="st"> </span><span class="kw">ts</span>(resurg<span class="op">$</span>wlevelm, <span class="dt">frequency =</span> <span class="dv">12</span><span class="op">*</span><span class="dv">365</span>, </span>
<span id="cb464-6"><a href="time-series.html#cb464-6"></a>              <span class="dt">start =</span> <span class="kw">c</span>(<span class="dv">1994</span>, <span class="dv">266</span><span class="op">*</span><span class="dv">12</span><span class="op">+</span><span class="dv">7</span>))</span>
<span id="cb464-7"><a href="time-series.html#cb464-7"></a>fit &lt;-<span class="st"> </span><span class="kw">stl</span>(wlevelm, <span class="dt">s.window=</span><span class="st">&quot;periodic&quot;</span>)</span>
<span id="cb464-8"><a href="time-series.html#cb464-8"></a><span class="kw">plot</span>(fit)</span></code></pre></div>
<p><img src="EnvDataSci_files/figure-html/unnamed-chunk-208-1.png" width="672" /></p>
<div id="lag-regression" class="section level3">
<h3><span class="header-section-number">8.3.1</span> lag regression</h3>
<p>[<strong><code>SolarRad_Temp</code></strong>]</p>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="time-series.html#cb465-1"></a><span class="kw">library</span>(readxl)</span>
<span id="cb465-2"><a href="time-series.html#cb465-2"></a>BugacSolstice &lt;-<span class="st"> </span><span class="kw">read_xls</span>(<span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;SolarRad_Temp.xls&quot;</span>, <span class="dt">package=</span><span class="st">&quot;iGIScData&quot;</span>), </span>
<span id="cb465-3"><a href="time-series.html#cb465-3"></a>                          <span class="dt">sheet=</span><span class="st">&quot;BugacHungary&quot;</span>, <span class="dt">col_types =</span> <span class="st">&quot;numeric&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb465-4"><a href="time-series.html#cb465-4"></a><span class="st">  </span><span class="kw">filter</span>(Year <span class="op">!=</span><span class="st"> &quot;YYYY&quot;</span> <span class="op">&amp;</span><span class="st"> `</span><span class="dt">Day of Yr</span><span class="st">`</span> <span class="op">&lt;</span><span class="st"> </span><span class="dv">177</span> <span class="op">&amp;</span><span class="st"> `</span><span class="dt">Day of Yr</span><span class="st">`</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">168</span>) <span class="op">%&gt;%</span></span>
<span id="cb465-5"><a href="time-series.html#cb465-5"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(SolarRad, Tair)</span>
<span id="cb465-6"><a href="time-series.html#cb465-6"></a>BugacSolsticeTS &lt;-<span class="st"> </span><span class="kw">ts</span>(BugacSolstice, <span class="dt">frequency =</span> <span class="dv">48</span>)</span>
<span id="cb465-7"><a href="time-series.html#cb465-7"></a><span class="kw">plot</span>(BugacSolstice, <span class="dt">main=</span><span class="st">&quot;a simple scatter plot that illustrates hysteresis&quot;</span>); <span class="kw">plot</span>(BugacSolsticeTS)</span></code></pre></div>
<p><img src="EnvDataSci_files/figure-html/unnamed-chunk-209-1.png" width="672" /><img src="EnvDataSci_files/figure-html/unnamed-chunk-209-2.png" width="672" /></p>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="time-series.html#cb466-1"></a>mod &lt;-<span class="st"> </span><span class="cf">function</span>(i) {<span class="kw">sqrt</span>(<span class="kw">sum</span>(<span class="kw">lm</span>(Tair<span class="op">~</span><span class="kw">lag</span>(SolarRad,i), <span class="dt">data=</span>BugacSolsticeTS)<span class="op">$</span>resid<span class="op">**</span><span class="dv">2</span>))}</span>
<span id="cb466-2"><a href="time-series.html#cb466-2"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">0</span><span class="op">:</span><span class="dv">5</span>){<span class="kw">print</span>(<span class="kw">paste</span>(i,<span class="st">&quot;:&quot;</span>,<span class="kw">mod</span>(i),<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))}</span></code></pre></div>
<pre><code>## [1] &quot;0:64.0135215060866&quot;
## [1] &quot;1:55.8980329398225&quot;
## [1] &quot;2:50.4934737943067&quot;
## [1] &quot;3:48.1321353382658&quot;
## [1] &quot;4:49.6489246846601&quot;
## [1] &quot;5:54.3634439433188&quot;</code></pre>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="time-series.html#cb468-1"></a>SolarRad_comp &lt;-<span class="st"> </span><span class="kw">decompose</span>(<span class="kw">ts</span>(BugacSolstice<span class="op">$</span>SolarRad, <span class="dt">frequency =</span> <span class="dv">48</span>))</span>
<span id="cb468-2"><a href="time-series.html#cb468-2"></a>Tair_comp &lt;-<span class="st"> </span><span class="kw">decompose</span>(<span class="kw">ts</span>(BugacSolstice<span class="op">$</span>Tair, <span class="dt">frequency =</span> <span class="dv">48</span>))</span>
<span id="cb468-3"><a href="time-series.html#cb468-3"></a>seasonals &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(<span class="dt">Rad =</span> SolarRad_comp<span class="op">$</span>seasonal, <span class="dt">Temp =</span> Tair_comp<span class="op">$</span>seasonal)</span>
<span id="cb468-4"><a href="time-series.html#cb468-4"></a><span class="kw">ggplot</span>(seasonals) <span class="op">+</span><span class="st"> </span></span>
<span id="cb468-5"><a href="time-series.html#cb468-5"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">seq_along</span>(Rad), <span class="dt">y=</span>Rad<span class="op">/</span><span class="dv">50</span>), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb468-6"><a href="time-series.html#cb468-6"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">seq_along</span>(Temp), <span class="dt">y=</span>Temp), <span class="dt">col=</span><span class="st">&quot;darkgreen&quot;</span>,<span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb468-7"><a href="time-series.html#cb468-7"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">480</span>,<span class="dv">12</span>))</span></code></pre></div>
<p><img src="EnvDataSci_files/figure-html/unnamed-chunk-209-3.png" width="672" /></p>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="time-series.html#cb469-1"></a><span class="kw">which.max</span>(seasonals<span class="op">$</span>Rad)</span></code></pre></div>
<pre><code>## [1] 23</code></pre>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="time-series.html#cb471-1"></a><span class="kw">which.max</span>(seasonals<span class="op">$</span>Temp)</span></code></pre></div>
<pre><code>## [1] 28</code></pre>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="time-series.html#cb473-1"></a><span class="kw">library</span>(readxl)</span>
<span id="cb473-2"><a href="time-series.html#cb473-2"></a>ManausSolstice &lt;-<span class="st"> </span><span class="kw">read_xls</span>(<span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;SolarRad_Temp.xls&quot;</span>, <span class="dt">package=</span><span class="st">&quot;iGIScData&quot;</span>), </span>
<span id="cb473-3"><a href="time-series.html#cb473-3"></a>                          <span class="dt">sheet=</span><span class="st">&quot;ManausBrazil&quot;</span>, <span class="dt">col_types =</span> <span class="st">&quot;numeric&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb473-4"><a href="time-series.html#cb473-4"></a><span class="st">  </span><span class="kw">filter</span>(Year <span class="op">!=</span><span class="st"> &quot;YYYY&quot;</span> <span class="op">&amp;</span><span class="st"> `</span><span class="dt">Day of Yr</span><span class="st">`</span> <span class="op">&lt;</span><span class="st"> </span><span class="dv">177</span> <span class="op">&amp;</span><span class="st"> `</span><span class="dt">Day of Yr</span><span class="st">`</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">168</span>) <span class="op">%&gt;%</span></span>
<span id="cb473-5"><a href="time-series.html#cb473-5"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(SolarRad, Tair)</span>
<span id="cb473-6"><a href="time-series.html#cb473-6"></a>ManausSolsticeTS &lt;-<span class="st"> </span><span class="kw">ts</span>(ManausSolstice, <span class="dt">frequency =</span> <span class="dv">48</span>)</span>
<span id="cb473-7"><a href="time-series.html#cb473-7"></a><span class="kw">plot</span>(ManausSolstice, <span class="dt">main=</span><span class="st">&quot;Manaus Brazil&quot;</span>); <span class="kw">plot</span>(ManausSolsticeTS)</span></code></pre></div>
<p><img src="EnvDataSci_files/figure-html/unnamed-chunk-210-1.png" width="672" /><img src="EnvDataSci_files/figure-html/unnamed-chunk-210-2.png" width="672" /></p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="time-series.html#cb474-1"></a>mod &lt;-<span class="st"> </span><span class="cf">function</span>(i) {<span class="kw">sqrt</span>(<span class="kw">sum</span>(<span class="kw">lm</span>(Tair<span class="op">~</span><span class="kw">lag</span>(SolarRad,i), <span class="dt">data=</span>ManausSolsticeTS)<span class="op">$</span>resid<span class="op">**</span><span class="dv">2</span>))}</span>
<span id="cb474-2"><a href="time-series.html#cb474-2"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">0</span><span class="op">:</span><span class="dv">5</span>){<span class="kw">print</span>(<span class="kw">paste</span>(i,<span class="st">&quot;:&quot;</span>,<span class="kw">mod</span>(i),<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))}</span></code></pre></div>
<pre><code>## [1] &quot;0:36.6765871805181&quot;
## [1] &quot;1:33.572327106606&quot;
## [1] &quot;2:31.9789648893589&quot;
## [1] &quot;3:31.2029493549955&quot;
## [1] &quot;4:31.6171985286944&quot;
## [1] &quot;5:32.6933416047147&quot;</code></pre>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="time-series.html#cb476-1"></a>SolarRad_comp &lt;-<span class="st"> </span><span class="kw">decompose</span>(<span class="kw">ts</span>(ManausSolstice<span class="op">$</span>SolarRad, <span class="dt">frequency =</span> <span class="dv">48</span>))</span>
<span id="cb476-2"><a href="time-series.html#cb476-2"></a>Tair_comp &lt;-<span class="st"> </span><span class="kw">decompose</span>(<span class="kw">ts</span>(ManausSolstice<span class="op">$</span>Tair, <span class="dt">frequency =</span> <span class="dv">48</span>))</span>
<span id="cb476-3"><a href="time-series.html#cb476-3"></a>seasonals &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(<span class="dt">Rad =</span> SolarRad_comp<span class="op">$</span>seasonal, <span class="dt">Temp =</span> Tair_comp<span class="op">$</span>seasonal)</span>
<span id="cb476-4"><a href="time-series.html#cb476-4"></a><span class="kw">ggplot</span>(seasonals) <span class="op">+</span><span class="st"> </span></span>
<span id="cb476-5"><a href="time-series.html#cb476-5"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">seq_along</span>(Rad), <span class="dt">y=</span>Rad<span class="op">/</span><span class="dv">50</span>), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb476-6"><a href="time-series.html#cb476-6"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">seq_along</span>(Temp), <span class="dt">y=</span>Temp), <span class="dt">col=</span><span class="st">&quot;darkgreen&quot;</span>,<span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb476-7"><a href="time-series.html#cb476-7"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">480</span>,<span class="dv">12</span>))</span></code></pre></div>
<p><img src="EnvDataSci_files/figure-html/unnamed-chunk-210-3.png" width="672" /></p>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="time-series.html#cb477-1"></a><span class="kw">which.max</span>(seasonals<span class="op">$</span>Rad)</span></code></pre></div>
<pre><code>## [1] 30</code></pre>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="time-series.html#cb479-1"></a><span class="kw">which.max</span>(seasonals<span class="op">$</span>Temp)</span></code></pre></div>
<pre><code>## [1] 30</code></pre>
</div>
<div id="ensemble-average" class="section level3">
<h3><span class="header-section-number">8.3.2</span> Ensemble Average</h3>
<p>For any time series data with meaningful time units like days or years (or even weeks
when the data varies by days of the week – this was the case with COVID-19 data),
ensemble averages are a good way to visualize changes in a variable over that time unit.</p>
<p>As you could see from the decomposition and sequential graphics we created for the Bugac and Manaus
solar radiation and temperature data, looking at what happens over one day as an “ensemble” of
all of the days – where the mean value is displayed along with error bars based on
standard deviations of the distribution – might be a useful figure.</p>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb481-1"><a href="time-series.html#cb481-1"></a><span class="kw">library</span>(cowplot)</span>
<span id="cb481-2"><a href="time-series.html#cb481-2"></a>Manaus &lt;-<span class="st"> </span><span class="kw">read_xls</span>(<span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>,<span class="st">&quot;SolarRad_Temp.xls&quot;</span>,<span class="dt">package=</span><span class="st">&quot;iGIScData&quot;</span>), </span>
<span id="cb481-3"><a href="time-series.html#cb481-3"></a>                   <span class="dt">sheet=</span><span class="st">&quot;ManausBrazil&quot;</span>, <span class="dt">col_types =</span> <span class="st">&quot;numeric&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb481-4"><a href="time-series.html#cb481-4"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(Year<span class="op">:</span>Tair) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Year <span class="op">!=</span><span class="st"> &quot;YYYY&quot;</span>)</span>
<span id="cb481-5"><a href="time-series.html#cb481-5"></a>ManausSum &lt;-<span class="st"> </span>Manaus <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Hr) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb481-6"><a href="time-series.html#cb481-6"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">meanRad =</span> <span class="kw">mean</span>(SolarRad), <span class="dt">meanTemp =</span> <span class="kw">mean</span>(Tair),</span>
<span id="cb481-7"><a href="time-series.html#cb481-7"></a>            <span class="dt">sdRad =</span> <span class="kw">sd</span>(SolarRad), <span class="dt">sdTemp =</span> <span class="kw">sd</span>(Tair))</span>
<span id="cb481-8"><a href="time-series.html#cb481-8"></a>px &lt;-<span class="st"> </span>ManausSum <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>Hr)) <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">3</span>))</span>
<span id="cb481-9"><a href="time-series.html#cb481-9"></a>p1 &lt;-<span class="st"> </span>px <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y=</span>meanRad), <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb481-10"><a href="time-series.html#cb481-10"></a><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymax =</span> meanRad <span class="op">+</span><span class="st"> </span>sdRad, <span class="dt">ymin =</span> meanRad <span class="op">-</span><span class="st"> </span>sdRad)) <span class="op">+</span></span>
<span id="cb481-11"><a href="time-series.html#cb481-11"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Manaus 2005 ensemble solar radiation&quot;</span>)</span>
<span id="cb481-12"><a href="time-series.html#cb481-12"></a>p2 &lt;-<span class="st"> </span>px <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y=</span>meanTemp),<span class="dt">col=</span><span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb481-13"><a href="time-series.html#cb481-13"></a><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymax=</span>meanTemp<span class="op">+</span>sdTemp, <span class="dt">ymin=</span>meanTemp<span class="op">-</span>sdTemp)) <span class="op">+</span></span>
<span id="cb481-14"><a href="time-series.html#cb481-14"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Manaus 2005 ensemble air temperature&quot;</span>)</span>
<span id="cb481-15"><a href="time-series.html#cb481-15"></a><span class="kw">plot_grid</span>(<span class="dt">plotlist=</span><span class="kw">list</span>(p1,p2), <span class="dt">ncol=</span><span class="dv">1</span>, <span class="dt">align=</span><span class="st">&#39;v&#39;</span>) <span class="co"># from cowplot</span></span></code></pre></div>
<p><img src="EnvDataSci_files/figure-html/unnamed-chunk-211-1.png" width="672" /></p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="time-series.html#cb482-1"></a>Bugac &lt;-<span class="st"> </span><span class="kw">read_xls</span>(<span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>,<span class="st">&quot;SolarRad_Temp.xls&quot;</span>,<span class="dt">package=</span><span class="st">&quot;iGIScData&quot;</span>), </span>
<span id="cb482-2"><a href="time-series.html#cb482-2"></a>                   <span class="dt">sheet=</span><span class="st">&quot;BugacHungary&quot;</span>, <span class="dt">col_types =</span> <span class="st">&quot;numeric&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb482-3"><a href="time-series.html#cb482-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(Year<span class="op">:</span>Tair) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Year <span class="op">!=</span><span class="st"> &quot;YYYY&quot;</span>)</span>
<span id="cb482-4"><a href="time-series.html#cb482-4"></a>BugacSum &lt;-<span class="st"> </span>Bugac <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Hr) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb482-5"><a href="time-series.html#cb482-5"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">meanRad =</span> <span class="kw">mean</span>(SolarRad), <span class="dt">meanTemp =</span> <span class="kw">mean</span>(Tair),</span>
<span id="cb482-6"><a href="time-series.html#cb482-6"></a>            <span class="dt">sdRad =</span> <span class="kw">sd</span>(SolarRad), <span class="dt">sdTemp =</span> <span class="kw">sd</span>(Tair))</span>
<span id="cb482-7"><a href="time-series.html#cb482-7"></a>px &lt;-<span class="st"> </span>BugacSum <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>Hr)) <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">3</span>))</span>
<span id="cb482-8"><a href="time-series.html#cb482-8"></a>p1 &lt;-<span class="st"> </span>px <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y=</span>meanRad), <span class="dt">col=</span><span class="st">&quot;blue&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb482-9"><a href="time-series.html#cb482-9"></a><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymax =</span> meanRad <span class="op">+</span><span class="st"> </span>sdRad, <span class="dt">ymin =</span> meanRad <span class="op">-</span><span class="st"> </span>sdRad)) <span class="op">+</span></span>
<span id="cb482-10"><a href="time-series.html#cb482-10"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Bugac 2005 ensemble solar radiation&quot;</span>)</span>
<span id="cb482-11"><a href="time-series.html#cb482-11"></a>p2 &lt;-<span class="st"> </span>px <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y=</span>meanTemp),<span class="dt">col=</span><span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb482-12"><a href="time-series.html#cb482-12"></a><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymax=</span>meanTemp<span class="op">+</span>sdTemp, <span class="dt">ymin=</span>meanTemp<span class="op">-</span>sdTemp)) <span class="op">+</span></span>
<span id="cb482-13"><a href="time-series.html#cb482-13"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Bugac 2005 ensemble air temperature&quot;</span>)</span>
<span id="cb482-14"><a href="time-series.html#cb482-14"></a><span class="kw">plot_grid</span>(<span class="dt">plotlist=</span><span class="kw">list</span>(p1,p2), <span class="dt">ncol=</span><span class="dv">1</span>, <span class="dt">align=</span><span class="st">&#39;v&#39;</span>) <span class="co"># from cowplot</span></span></code></pre></div>
<p><img src="EnvDataSci_files/figure-html/unnamed-chunk-211-2.png" width="672" /></p>
</div>
<div id="julian-dates" class="section level3">
<h3><span class="header-section-number">8.3.3</span> Julian Dates</h3>
<p>Julian dates are the number of days since some start date</p>
<ul>
<li>The origin (Julian date 0) can be arbitrary</li>
<li>Default for julian() is 1970-01-01</li>
</ul>
<p>For climatological work where the year is very important, it usually means the number of days of any given year</p>
<ul>
<li>lubridate’s yday() gives you this.</li>
<li>same thing as setting the origin for julian() as the 12-31 of the previous year.</li>
<li>Useful in time series when the year is the time unit and observations are by days of the year (e.g. for climate data)</li>
</ul>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb483-1"><a href="time-series.html#cb483-1"></a><span class="kw">library</span>(lubridate)</span>
<span id="cb483-2"><a href="time-series.html#cb483-2"></a><span class="kw">julian</span>(<span class="kw">ymd</span>(<span class="st">&quot;2020-01-01&quot;</span>))</span></code></pre></div>
<pre><code>## [1] 18262
## attr(,&quot;origin&quot;)
## [1] &quot;1970-01-01&quot;</code></pre>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="time-series.html#cb485-1"></a><span class="kw">julian</span>(<span class="kw">ymd</span>(<span class="st">&quot;1970-01-01&quot;</span>))</span></code></pre></div>
<pre><code>## [1] 0
## attr(,&quot;origin&quot;)
## [1] &quot;1970-01-01&quot;</code></pre>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="time-series.html#cb487-1"></a><span class="kw">yday</span>(<span class="kw">ymd</span>(<span class="st">&quot;2020-01-01&quot;</span>))</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="time-series.html#cb489-1"></a><span class="kw">julian</span>(<span class="kw">ymd</span>(<span class="st">&quot;2020-01-01&quot;</span>), <span class="dt">origin=</span><span class="kw">ymd</span>(<span class="st">&quot;2019-12-31&quot;</span>))</span></code></pre></div>
<pre><code>## [1] 1
## attr(,&quot;origin&quot;)
## [1] &quot;2019-12-31&quot;</code></pre>
<p>To create a decimal yday including fractional days, here’s a function:</p>
<pre><code>ydayDec &lt;- function(d) {
           yday(d)-1 + hour(d)/24 + minute(d)/1440 + second(d)/86400}</code></pre>
</div>
</div>
<div id="learning-more-about-time-series-in-r" class="section level2">
<h2><span class="header-section-number">8.4</span> Learning more about time series in R</h2>
<p>It can be confusing, partly because of the major use of time series in the financial sector, so a search gets you quickly into the monetizing world…</p>
<p>One good source is actually at CRAN:
<a href="https://cran.r-project.org/web/views/TimeSeries.html">https://cran.r-project.org/web/views/TimeSeries.html</a></p>
<p>Time series data library:
<a href="https://pkg.yangzhuoranyang.com/tsdl/">https://pkg.yangzhuoranyang.com/tsdl/</a></p>
<p>Understanding time series in R:
<a href="https://a-little-book-of-r-for-time-series.readthedocs.io/">https://a-little-book-of-r-for-time-series.readthedocs.io/</a></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="statistics-and-modeling.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="communication.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["EnvDataSci.pdf", "EnvDataSci.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
